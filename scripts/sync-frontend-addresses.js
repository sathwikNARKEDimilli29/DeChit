// Syncs addresses from deployments/last-deploy.json to frontend/src/defaultAddresses.ts
const fs = require("fs");
const path = require("path");

function main() {
  const root = process.cwd();
  const src = path.join(root, "deployments", "last-deploy.json");
  const outDir = path.join(root, "frontend", "src");
  const outFile = path.join(outDir, "defaultAddresses.ts");

  if (!fs.existsSync(src)) {
    console.warn("[sync-frontend-addresses] deployments/last-deploy.json not found. Skipping.");
    return;
  }
  if (!fs.existsSync(outDir)) fs.mkdirSync(outDir, { recursive: true });

  const raw = fs.readFileSync(src, "utf8");
  const data = JSON.parse(raw);
  const token = data.ChitToken || "";
  const oracle = data.CreditScoreOracle || "";
  const fund = data.ChitFund || "";

  const content = `// Auto-generated by scripts/sync-frontend-addresses.js\nexport const DEFAULT_ADDRESSES = {\n  token: '${token}',\n  oracle: '${oracle}',\n  fund: '${fund}',\n} as const;\n`;

  fs.writeFileSync(outFile, content, "utf8");
  console.log("[sync-frontend-addresses] Wrote", path.relative(root, outFile));
}

try { main(); } catch (e) { console.error(e); process.exit(1); }

